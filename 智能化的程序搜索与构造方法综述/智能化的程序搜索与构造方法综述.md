# 智能化的程序搜索与构造方法综述

## 目的
利用互联网中已有的代码资源以及群体的智慧和能力，来提高软件开发的效率和质量

## 传统的程序构造技术
- 方法
    - 模型驱动的软件开发：利用领域特定模型语言描述系统，然后利用转换器和生成器自动生成各种类型的软件制品（主要指程序代码）
        - entity->code 
    - 基于逻辑规约的程序合成：利用用户提供的规约，通过定理证明等形式化方法来产生程序代码
        - proof->code 
- 局限
    - 对开发人员要求高
    - 通用性差
    - 对于大规模复杂软件系统的可扩展能力不足

## 智能化的程序搜索与构造
- 示意图
    ![image](https://raw.githubusercontent.com/yyy2015/Research-Paper/master/%E6%99%BA%E8%83%BD%E5%8C%96%E7%9A%84%E7%A8%8B%E5%BA%8F%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%BB%BC%E8%BF%B0/%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
- 主要研究问题
    - **程序搜索**：根据自然语言描述、程序结构描述、测试用例等查询规约，通过对互联网代码资源库进行搜索，得到满足特定约束的程序代码
    - **程序合成**：根绝<输入-输出>数据对、自然语言或领域特定语言描述的规约自动生成相应的程序代码
    - **代码推荐与补全**：根据程序上下文为用户推荐候选代码，或根据已有的部分程序补全生成完整代码
    - **缺陷检测**：数据驱动的，基于机器学习方法的智能化缺陷检测，与传统的缺陷检测方法不同，主要指根据从大量代码中自动学习出的质量特征来发现被分析程序中的缺陷
    - **代码风格改善**：在不改变程序外部行为的前提下，根据互联网中具有良好规范的代码为程序代码的编码风格等给出改善建议
    - **程序自动修复**：针对给定的程序问题，自动生成程序补丁，能够修复程序中的错误
- 技术谱系
    ![image](https://raw.githubusercontent.com/yyy2015/Research-Paper/master/%E6%99%BA%E8%83%BD%E5%8C%96%E7%9A%84%E7%A8%8B%E5%BA%8F%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%BB%BC%E8%BF%B0/%E6%99%BA%E8%83%BD%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9E%84%E9%80%A0%E6%8A%80%E6%9C%AF%E8%B0%B1%E7%B3%BB.png)

### 代码搜索
- 一般过程
    - 搜索规约的选取
    - 搜索方法的选择
    - 搜索结果的排序
- 分类
    - 从搜索规约角度
        - 基于关键字的搜索
        - 基于程序结构的搜索
        - 基于测试用例的搜索
    - 从代码搜索结果的粒度
        - 代码片段粒度的搜索
        - 代码模块粒度的搜索
        - 代码文件粒度的搜索
    - 搜索对象的角度
        - 对代码库的搜索
        - 对代码相关文档的搜索

#### 增强代码资源描述信息
该类方法通过对代码和相关文档等进行分析，通过增强代码的索引或标注信息来提高查询的准确性
- 代码文本+注释信息
    - 源代码+API信息+API文档 -> 含有丰富注释信息的源代码
- 基于查询分析和扩展布尔模型的代码搜索方法
    - 建立索引：识别代码特征，对源代码进行解析并建立索引
    - 查询分析：分析查询语句与API之间的相关性
    - 布尔模型：对查询表达式与代码实体进行相似度评估
- 利用实体获取技术来提高代码搜索准确率
    - 利用词性标注以及模式匹配获取命名实体对应的自然语言术语，并抽取得到相关的句法形式，然后构造一个实体的知识库，然后利用该知识库对源代码中的每行代码利用相对应的自然语言术语进行注释

#### 提高查询规约描述能力
该类方法通过增强用户的查询规约来提高全面、准确地刻画用户需求的能力
- 对代码特征的搜索策略
- 基于程序语义的代码搜索
- 利用查询扩展来增强用户规约
    - 基于辞典自动进行查询扩展
    
    ![image](https://raw.githubusercontent.com/yyy2015/Research-Paper/master/%E6%99%BA%E8%83%BD%E5%8C%96%E7%9A%84%E7%A8%8B%E5%BA%8F%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%BB%BC%E8%BF%B0/%E5%88%A9%E7%94%A8%E8%BE%9E%E5%85%B8%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%E6%89%A9%E5%B1%95.png)
    - 基于群体知识的查询扩展方法
        - 伪相关反馈方法：从stackOverFlow的问答信息中获取软件相关词汇，然后对原始的查询规约进行扩展
    - 在集成开发环境中利用众包化的知识进行代码搜索
        - 查询规约->通过stack overflow翻译为API->在Github中搜索API对应的示例代码


#### 通过语义分析提高匹配精确度
该类方法通过在搜索中加入程序分析的一些理论，以提高搜索规约和被搜索程序之间的匹配精确性
- 将代码搜索问题归纳为约束求解问题，提出利用<输入-输出>数据对和约束求解的方法来进行基于语义的代码搜索方法
- 根据用户的查询自动给出方法调用序列：采用“源对象类型->目标对象类型”格式的查询作为输入，通过代码搜索引起获得相关的代码样本，然后通过对其进行静态分析抽取得到相应的调用序列
- 在代码搜索中自动获取相关函数及其用法：结合自然语言处理技术和PageRank的标注技术，能够为用户返回排序后的一组相关函数（将用户对于搜索结果的反馈用于排序）

### 程序合成
程序合成是一种针对用户意图，构造出相关程序的软件开发活动，与程序员具体编程完成一项任务不同，它关注在让计算机理解用户需要什么，进而去自动化编程，其最终目标是让机器能够自动地去编写代码
- 程序合成过程的三个维度
    - 用户意图的表达
    - 程序搜索空间的刻画
    - 搜索技术的设计

#### 归纳程序合成（Inductive Program Synthesis, IPS）
- 目标：给定一组<输入-输出>数据对，如何产生一段代码能够自动将给定的输入转换成给定的输出
- 两个过程
    - 代码空间的搜索
    - 代码结果的排序
- 利用<输入-输出>数值对进行归纳编程的程序合成方法
    - 将搜索空间限制到领域特定语言
    - "分而治之"思想，将大的程序合成问题分解为小规模的子问题
- 利用自然语言描述的规约来进行程序合成的方法
    - 通过对包含<自然语言-领域特定语言>数据对的训练集进行学习，能够将自然语言翻译为领域特定语言，然后再执行程序合成工作
- 结合上述两种方法
- 利用群体智慧来进行自然语言编程的程序合成方法
    - 让非专业人士提供大量的<输入-输出>数据对
    - <输入-输出>数值对进行归纳编程
- 不同的利用<输入-输出>数值对进行程序合成的方法
    - 根据<输入-输出>数值对生成对目标程序结构的假设
    - 对每个假设，为缺失的子表达式演绎生成新的<输入-输出>数据对
    - 再对每个假设进行程序合成工作
- 利用Java文档中的自然语言表述自动为API生成相应代码

#### 基于搜索的程序合成
该类方法通常与代码搜索结合在一起，首先通过代码搜索得到相关的代码片段或者API调用序列，然后对其进行一系列的变换和处理，以满足用户的需求
- 根据自然语言描述的查询规约得到与之相对应的API名称，然后利用结构化调用序列的形式挖掘得到API的使用模式，并根据它生成代码片段
- Hunter利用代码搜索得到搜索结果，通过计算所得结果与目标类型之间的距离值，对结果进行重排序，然后进行接口匹配并合成生成相应的包装代码，从而得到候选结果，最后利用测试用例对结果进行筛选

#### 基于深度学习的自动编程
模型训练->模型应用
- 输入输出+代码片段
- 利用神经网络
- 根据给定的规约利用深度学习生成相应API调用序列的方法
    - 根据自然语言查询规约自动生成API使用序列的方法
- 利用众包来进行程序合成的方法
    - 将开发者的复杂程序问题利用众包获得初始结果，在将初始结果进行合并以获得更加精确的结果

### 代码推荐与补全
- 常用方法：利用自然语言处理技术，将代码视为文本，融合机器学习或者深度学习的算法，利用统计的语言模型对代码进行建模并对语句的概率进行预测，对当前代码序列的后续语句、函数进行推荐或者对缺失的代码进行补全
- N-gram模型
- N-gram模型+Cache
- 利用贝叶斯网络进行代码补全
- 基于示例的代码补全系统
- 语义的n-gram模型+主题模型
- 基于图的统计语言模型GraLan用于API推荐
- 利用细粒度的代码修改信息中包含的规律性进行代码推荐
- 带概率的高阶文法定义

### 缺陷检测
- 利用自然语言处理方法，对程序中违背统计规律的异常位置进行缺陷检测
- 利用开源社区和问答网站中的知识或者程序的演化历史信息来进行缺陷检测
    - 利用问答网站中的信息来帮助缺陷检测的方法
    - 利用语言模型来提高编译器错误报告性能的方法
    - 从代码资源库中挖掘得到缺陷模式的方法
- 利用机器学习和数据挖掘算法来进行缺陷检测
    - 通过切片技术尽量消除噪声代码来提高缺陷挖掘的精确度
    - 一种贝叶斯方法

## 面临的主要挑战和研究方向
- 主要挑战
    - 人的高层需求描述和具体程序语义之间的映射存在鸿沟
    - 难以建立统计语义和传统程序语义之间的联系
    - 如何将海量代码中获取的知识与开发团队人员的群体智慧有效融合
    - 缺乏被广泛认可的智能化程序构造评价标准和通用的测试集
- 研究方向
    - 异源异构代码知识的获取与建模
    - 智能化程序搜索与构造
    - 智能化的代码质量保证技术
    - 程序搜索与构造方法的评价以及协同开发环境


## 待解决问题
- 什么是传统的缺陷检测方法？
- 程序代码中包含着类似自然语言中的统计性规律，这一规律是什么？
- 如何识别代码特征？
- 什么是统计语义？
- 什么是伪相关反馈方法？
    - 把初始查询返回的结果当成相关结果
- 什么是PageRank的标注技术？
    - 被用户访问越多的网页可能质量越高
